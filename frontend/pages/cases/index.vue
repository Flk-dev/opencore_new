<template>
  <div class="sticky__page page-pd-bottom">
    <GlobalPageHeader :is-sticky="true">
      <svg width="895" height="111" viewBox="0 0 895 111" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M16.8006 94.9581C5.93354 84.285 0.5 71.1539 0.5 55.5C0.5 39.9108 5.93354 26.7797 16.8006 16.042C27.6677 5.36888 41.1222 0 57.1641 0C73.206 0 86.6605 5.36888 97.5276 16.042C108.395 26.715 113.828 39.8462 113.828 55.5C113.828 71.0892 108.395 84.2203 97.5276 94.9581C86.6605 105.631 73.206 111 57.1641 111C41.1222 110.935 27.6677 105.631 16.8006 94.9581ZM33.0366 30.4021C26.5034 37.1941 23.2691 45.5385 23.2691 55.5C23.2691 65.4615 26.5034 73.8059 33.0366 80.5979C39.5698 87.3899 47.5907 90.7535 57.1641 90.7535C66.8022 90.7535 74.8878 87.3899 81.3563 80.5979C87.8248 73.8059 91.0591 65.4615 91.0591 55.5C91.0591 45.5385 87.8248 37.1941 81.3563 30.4021C74.8878 23.6101 66.8022 20.2465 57.1641 20.2465C47.5907 20.2465 39.5698 23.6101 33.0366 30.4021Z" fill="#0000FF"/>
        <path d="M149.415 109.324H127.422V1.55859H173.025C184.798 1.55859 194.371 4.92223 201.68 11.7142C208.99 18.5062 212.612 27.1093 212.612 37.5883C212.612 48.0674 208.99 56.6058 201.745 63.2037C194.5 69.8016 184.927 73.1653 173.025 73.1653H149.479V109.324H149.415ZM149.415 21.0936V53.5656H172.96C178.006 53.5656 182.016 52.0779 185.121 49.0376C188.226 45.9974 189.714 42.1163 189.714 37.3943C189.714 32.6723 188.161 28.7911 185.121 25.6862C182.016 22.5813 178.006 21.0936 172.96 21.0936H149.415Z" fill="#0000FF"/>
        <path d="M294.504 109.324H222.703V1.55859H294.504V21.0936H244.761V45.7387H292.951V65.1443H244.761V89.7894H294.504V109.324Z" fill="#0000FF"/>
        <path d="M383.638 104.602V1.55859H405.631V109.389H362.809L331.307 6.28063V109.324H309.314V1.55859H352.007L383.638 104.602Z" fill="#0000FF"/>
        <path d="M422.625 66.0087C422.625 48.7308 429.232 33.5365 442.444 20.4257C455.758 7.31483 471.156 0.759413 488.637 0.759413C500.02 0.759413 509.625 3.65599 517.45 9.44915C525.276 15.1407 530.51 22.4584 533.153 31.4022L521.567 35.8233C519.737 28.6072 515.824 22.8141 509.828 18.4438C503.933 13.9719 496.717 11.7359 488.18 11.7359C474.052 11.7359 461.602 17.1734 450.829 28.0482C440.157 38.8215 434.822 51.2717 434.822 65.3989C434.822 75.359 438.023 83.5406 444.426 89.9436C450.829 96.3465 459.214 99.548 469.581 99.548C478.118 99.548 486.299 97.3629 494.125 92.9926C501.951 88.5207 508.303 82.6767 513.182 75.4607L523.853 80.3391C517.959 89.0797 510.183 96.2957 500.528 101.987C490.873 107.679 480.405 110.525 469.123 110.525C455.504 110.525 444.324 106.408 435.584 98.1759C426.945 89.8419 422.625 79.1195 422.625 66.0087ZM624.238 109H612.194L606.096 80.644H550.299L532.005 109H519.046L587.954 2.28393H600.76L624.238 109ZM592.071 15.6997L557.159 69.82H603.657L592.071 15.6997ZM634.11 81.5587L645.849 79.1195C647.272 92.9418 655.708 99.8529 671.156 99.8529C679.388 99.8529 686.147 97.9219 691.432 94.0598C696.717 90.1976 699.36 85.4208 699.36 79.7293C699.36 75.1558 697.53 71.3953 693.871 68.4479C690.314 65.3989 685.944 63.0105 680.76 61.2827C675.679 59.4533 670.546 57.5222 665.363 55.4895C660.18 53.4568 655.758 50.5094 652.1 46.6473C648.542 42.6836 646.764 37.7543 646.764 31.8595C646.764 23.0173 650.524 15.6488 658.045 9.75406C665.566 3.75763 674.815 0.759413 685.791 0.759413C695.853 0.759413 703.781 3.40191 709.574 8.68689C715.367 13.8702 718.924 20.883 720.245 29.7252L708.507 32.1644C707.592 25.4566 705.102 20.324 701.037 16.7668C697.073 13.108 691.737 11.2786 685.029 11.2786C677.61 11.2786 671.461 13.108 666.582 16.7668C661.704 20.4257 659.265 24.8976 659.265 30.1826C659.265 34.5528 661.043 38.1609 664.601 41.0066C668.259 43.8524 672.63 46.19 677.711 48.0194C682.895 49.7472 688.078 51.6274 693.262 53.6601C698.445 55.6928 702.815 58.7926 706.372 62.9596C710.031 67.025 711.861 72.1067 711.861 78.2048C711.861 87.6568 707.897 95.4318 699.969 101.53C692.042 107.526 682.234 110.525 670.546 110.525C659.875 110.525 651.388 107.984 645.087 102.902C638.887 97.7186 635.228 90.6042 634.11 81.5587ZM788.296 109H722.742L745.457 2.28393H811.011L808.724 13.108H755.062L746.982 50.3062H799.272L796.986 60.9778H744.695L736.92 98.1759H790.583L788.296 109ZM806.958 81.5587L818.697 79.1195C820.12 92.9418 828.555 99.8529 844.004 99.8529C852.236 99.8529 858.995 97.9219 864.28 94.0598C869.565 90.1976 872.207 85.4208 872.207 79.7293C872.207 75.1558 870.378 71.3953 866.719 68.4479C863.162 65.3989 858.792 63.0105 853.608 61.2827C848.527 59.4533 843.394 57.5222 838.211 55.4895C833.027 53.4568 828.606 50.5094 824.947 46.6473C821.39 42.6836 819.612 37.7543 819.612 31.8595C819.612 23.0173 823.372 15.6488 830.893 9.75406C838.414 3.75763 847.663 0.759413 858.639 0.759413C868.701 0.759413 876.629 3.40191 882.422 8.68689C888.215 13.8702 891.772 20.883 893.093 29.7252L881.355 32.1644C880.44 25.4566 877.95 20.324 873.884 16.7668C869.921 13.108 864.585 11.2786 857.877 11.2786C850.458 11.2786 844.309 13.108 839.43 16.7668C834.552 20.4257 832.113 24.8976 832.113 30.1826C832.113 34.5528 833.891 38.1609 837.448 41.0066C841.107 43.8524 845.478 46.19 850.559 48.0194C855.743 49.7472 860.926 51.6274 866.109 53.6601C871.293 55.6928 875.663 58.7926 879.22 62.9596C882.879 67.025 884.708 72.1067 884.708 78.2048C884.708 87.6568 880.745 95.4318 872.817 101.53C864.89 107.526 855.082 110.525 843.394 110.525C832.722 110.525 824.236 107.984 817.935 102.902C811.735 97.7186 808.076 90.6042 806.958 81.5587Z" fill="#0000FF"/>
      </svg>
    </GlobalPageHeader>

    <div class="cases">
      <div class="cases__container container">
        <CasesFilter class="cases__filter" @filter="filter" />
        <CasesGrid class="cases--archive" :data="posts" />
        <GlobalLoadmore @loadMore="loadMore" />
      </div>
    </div>
  </div>

  <GlobalFooterButton />
</template>

<script setup>
const termId = ref( 0 );
const page = ref( 1 );
const maxPage = ref( 0 );

const { data: posts } = await useAsyncData(
    'cases',
    () => $fetch(getApiUrl( '/cases/' ), {
      params: {
        category: termId.value,
        page: page.value
      }
    }), {
      watch: [termId, page],
      transform: ( resData ) => {
        maxPage.value = resData.data.max_page;

        return (page.value === 1 ? resData.data.posts : [...posts.value, ...resData.data.posts]);
      },
    },
);

const filter = (id) => {
  termId.value = id;
  page.value = 1;
};

const loadMore = () => {
  page.value++;
};
</script>

<style scoped lang="scss">
//.cases--archive {
//  & :deep(.cases__col) {
//    border: none;
//  }
//
//  :deep(.cases__line) {
//    display: none !important;
//  }
//}
//
//.cases--archive:before {
//  display: none;
//}

.cases__filter {
  position: sticky;
  top: 0;
  z-index: 50;
  background: var(--fg-white);
  padding: 1rem 0;
  transition: all .3s;

  @media (max-width: $tablet) {
    top: 7.4rem;
  }

  @media (max-width: $tablet) {
    top: 6.8rem;
  }
}
</style>