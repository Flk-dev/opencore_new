<template>
  <div class="sticky__page page-pd-bottom">
    <GlobalPageHeader is-sticky="true">
      <svg width="831" height="111" viewBox="0 0 831 111" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M16.8006 94.9581C5.93354 84.285 0.5 71.1539 0.5 55.5C0.5 39.9108 5.93354 26.7797 16.8006 16.042C27.6677 5.36888 41.1222 0 57.1641 0C73.206 0 86.6605 5.36888 97.5276 16.042C108.395 26.715 113.828 39.8462 113.828 55.5C113.828 71.0892 108.395 84.2203 97.5276 94.9581C86.6605 105.631 73.206 111 57.1641 111C41.1222 110.935 27.6677 105.631 16.8006 94.9581ZM33.0366 30.4021C26.5034 37.1941 23.2691 45.5385 23.2691 55.5C23.2691 65.4615 26.5034 73.8059 33.0366 80.5979C39.5698 87.3899 47.5907 90.7535 57.1641 90.7535C66.8022 90.7535 74.8878 87.3899 81.3563 80.5979C87.8248 73.8059 91.0591 65.4615 91.0591 55.5C91.0591 45.5385 87.8248 37.1941 81.3563 30.4021C74.8878 23.6101 66.8022 20.2465 57.1641 20.2465C47.5907 20.2465 39.5698 23.6101 33.0366 30.4021Z" fill="#0000FF"/>
        <path d="M149.415 109.328H127.422V1.5625H173.025C184.798 1.5625 194.371 4.92614 201.68 11.7181C208.99 18.5101 212.612 27.1132 212.612 37.5922C212.612 48.0713 208.99 56.6097 201.745 63.2076C194.5 69.8055 184.927 73.1692 173.025 73.1692H149.479V109.328H149.415ZM149.415 21.0975V53.5695H172.96C178.006 53.5695 182.016 52.0818 185.121 49.0416C188.226 46.0013 189.714 42.1202 189.714 37.3982C189.714 32.6762 188.161 28.795 185.121 25.6901C182.016 22.5852 178.006 21.0975 172.96 21.0975H149.415Z" fill="#0000FF"/>
        <path d="M294.504 109.328H222.703V1.5625H294.504V21.0975H244.761V45.7426H292.951V65.1482H244.761V89.7933H294.504V109.328Z" fill="#0000FF"/>
        <path d="M383.638 104.606V1.5625H405.631V109.393H362.809L331.307 6.28453V109.328H309.314V1.5625H352.007L383.638 104.606Z" fill="#0000FF"/>
        <path d="M493.35 55.0322C497.517 56.9632 500.77 59.7582 503.107 63.417C505.445 66.9742 506.614 70.9379 506.614 75.3082C506.614 84.6586 503.006 92.6369 495.789 99.2431C488.675 105.748 479.833 109 469.263 109H422.308L445.023 2.28393H485.423C493.655 2.28393 500.261 4.51988 505.241 8.9918C510.222 13.4637 512.712 19.0028 512.712 25.609C512.712 31.9103 510.933 37.7035 507.376 42.9885C503.92 48.1718 499.245 52.1864 493.35 55.0322ZM483.746 12.8031H454.323L446.243 50.4586H475.666C482.78 50.4586 488.828 48.2227 493.808 43.7507C498.788 39.1772 501.278 33.7906 501.278 27.5909C501.278 23.2206 499.702 19.6634 496.552 16.9193C493.503 14.1751 489.234 12.8031 483.746 12.8031ZM436.181 98.4808H468.958C476.072 98.4808 482.12 96.1941 487.1 91.6205C492.181 87.047 494.722 81.6604 494.722 75.4607C494.722 71.0904 493.147 67.584 489.996 64.9415C486.947 62.1974 482.628 60.8253 477.038 60.8253H444.108L436.181 98.4808ZM582.698 109H517.143L539.859 2.28393H551.75L531.321 98.1759H584.984L582.698 109ZM591.456 66.0087C591.456 48.7308 598.063 33.5365 611.275 20.4257C624.589 7.31483 639.987 0.759413 657.468 0.759413C671.087 0.759413 682.216 4.92642 690.855 13.2604C699.595 21.4928 703.966 32.1644 703.966 45.2753C703.966 62.5531 697.309 77.7474 683.994 90.8583C670.782 103.969 655.435 110.525 637.954 110.525C624.335 110.525 613.155 106.408 604.415 98.1759C595.776 89.8419 591.456 79.1195 591.456 66.0087ZM603.652 65.3989C603.652 75.359 606.854 83.5406 613.257 89.9436C619.66 96.3465 628.045 99.548 638.411 99.548C652.539 99.548 664.938 94.1614 675.61 83.3881C686.383 72.5133 691.769 60.0122 691.769 45.8851C691.769 35.9249 688.568 27.7433 682.165 21.3404C675.762 14.9374 667.377 11.7359 657.011 11.7359C642.883 11.7359 630.433 17.1734 619.66 28.0482C608.988 38.8215 603.652 51.2717 603.652 65.3989ZM761.229 62.1974L763.516 51.3733H826.631C824.801 68.0414 817.382 82.0669 804.373 93.4499C791.465 104.833 777.033 110.525 761.077 110.525C747.458 110.525 736.278 106.408 727.537 98.1759C718.898 89.8419 714.579 79.1195 714.579 66.0087C714.579 48.7308 721.185 33.5365 734.398 20.4257C747.712 7.31483 763.109 0.759413 780.59 0.759413C791.973 0.759413 801.578 3.65599 809.404 9.44915C817.23 15.1407 822.464 22.4584 825.106 31.4022L813.52 35.8233C811.69 28.6072 807.778 22.8141 801.781 18.4438C795.886 13.9719 788.67 11.7359 780.133 11.7359C766.006 11.7359 753.556 17.1734 742.782 28.0482C732.111 38.8215 726.775 51.2717 726.775 65.3989C726.775 75.359 729.976 83.5406 736.379 89.9436C742.782 96.3465 751.167 99.548 761.534 99.548C772.917 99.548 783.385 95.8892 792.939 88.5715C802.594 81.1522 808.896 72.3608 811.843 62.1974H761.229Z" fill="#0000FF"/>
      </svg>
    </GlobalPageHeader>
    <div class="blog">
      <div class="blog__container container">
        <BlogFilters @filter="filter" />
        <BlogGrid :data="posts" />
        <GlobalLoadmore v-if="posts.length" class="blog__loadmore"  @loadMore="loadMore" />
      </div>
    </div>
  </div>

  <GlobalFooterButton />
</template>

<script setup lang="ts">
const termId: any = ref( 0 );
const page: any = ref( 1 );

const { data: posts } = await useAsyncData(
    'blog',
    (): any => $fetch(getApiUrl('/blog/'), {
      params: {
        category: termId.value,
        page: page.value
      }
    }), {
      watch: [termId, page],
      transform: (resData: object) => {
        return (page.value === 1 ? resData.data : [...posts.value, ...resData.data]);
      },
    },
);

const filter = (id: number | string) => {
  termId.value = id;
  page.value = 1;
};

const loadMore = () => {
  page.value++;
};
</script>

<style scoped lang="scss">
.blog__loadmore {
  margin-top: 14rem;

  @media (max-width: $tablet) {
    margin-top: 10rem;
  }

  @media (max-width: $mobile) {
    margin-top: 9rem;
  }
}
</style>